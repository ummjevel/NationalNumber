
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.7.2/proj4.js'></script> -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script type="text/javascript" src="https://code.jquery.com/jquery-latest.js"></script>	
		<script type="text/javascript" src="https://sgisapi.kostat.go.kr/OpenAPI3/auth/javascriptAuth?consumer_key=ea852adca0c8454dae6b"></script>
		<script>
			// key and values for converting utmk to national number.
			var nn_est = { 7: "가", 8: "나", 9: "다", 10: "라", 11: "마", 12: "바", 13: "사" };
			var nn_nor = { 13: "가", 14: "나", 15: "다", 16: "라", 17: "마", 18: "바", 19: "사", 20: "아" };
			
			window.onload = function() {
				
				// init map
				/*
				var map = sop.map("map");
				var utmkXY = new sop.LatLng (36.3504119,127.3845475); 
				map.setView(sop.utmk(utmkXY.x, utmkXY.y), 9); 
				// draw map
				var html = "<p>wgs84 :  36.3504119,127.3845475</p>";
				html += "<p>x = "+utmkXY.x+" , y = "+utmkXY.x+"</p>";
				$("#divCon").append(html);
				console.log(html);
				*/
			};	
			
			// converter latitude, longitude to National Number
			function Wgs842NN(latitude, longitude) {
				// 위도 경도 범위 확인, 실패 시 범위 벗어났다고 표시
				
				// convert wgs84(lat, log) -> utm-k -> National Number
				var utmkXY = new sop.LatLng(latitude, longitude);
				if (utmkXY.x != undefined && utmkXY.y != undefined) {
					var key_est = parseInt(utmkXY.x/100000);
					var key_nor = parseInt(utmkXY.y/100000);
					if (key_est in nn_est && key_nor in nn_nor) {
						var rest_est = (utmkXY.x + "").slice((key_est + "").length).slice(0, 4);
						var rest_nor = (utmkXY.y + "").slice((key_nor + "").length).slice(0, 4);
						
						return nn_est[key_est] + nn_nor[key_nor] + " " + rest_est + " " + rest_nor;
					}
				} else {
					return "변환에 실패하였습니다.";
				}
				
			}
			
			function convert2NN(latitude, longitude) {
				var result = Wgs842NN(latitude, longitude);
				console.log("latitude: " + latitude + ", longitude: " + longitude + ", NN: " + result);
				$("#temp_text").text(result);
				window.webkit.messageHandlers.test.postMessage(result);
				return result;
			}
			
			function test() {
				// native -> javascript
				try {
					// console.log("function test called");
					$("#temp_text").text("function test called");
					alert('hello world');
					// window.webkit.messageHandlers.test.postMessage("test completed1");
				} catch(err) {
					alert(err);
				}
			}
			
			function test2() {
				// javascript -> native
				try {
					console.log("function test2 called");
					$("#temp_text").text("function test2 called");
					window.webkit.messageHandlers.test.postMessage("test completed2");
				} catch(err) {
					alert(err);
				}
			}
			
			function test3() {
				try {
					console.log("function test called");
					$("#temp_text").text("function test3 called");
					window.webkit.messageHandlers.test.postMessage("test completed3");
				} catch(err) {
					alert(err);
				}
			}
			
			

		</script>
		<title>National Number API</title>
	</head>
	<body>
		<!--
		<div style="text-align: center;">
		    <span id="temp_text" style="font-size: 15pt;">변환 기능을 실행해주세요.</span>
		</div>
		-->
		<p id="temp_text" style="text-align: center;">변환 기능을 실행해주세요.</p>
		<!--
		경도<input type='text' id='input_longitude'/>
		위도<input type='text' id='input_latitude'/>
		<input type='button' value='convert' id='btn_convert'/>
		<input type='button' value='test1' id='btn_test1' onclick='test();'/>
		<input type='button' value='test2' id='btn_test2' onclick='test2();'/>
		<input type='button' value='test3' id='btn_test3' onclick='test3();'/>
		<div id="map" class="" style="width:90%-20px;height:580px;z-index:1200"></div>
		<div id="divCon"></div>
		-->
	</body>
</html>
